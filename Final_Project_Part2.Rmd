---
title: "Final_Project_Part2"
author: "Zhuofei Xie"
date: "10/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(tidyquant)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(TTR)
library(lubridate)
library(fs)
library(plotly)
pacman::p_load(tidyverse,tidyquant,PortfolioAnalytics,quantmod,PerformanceAnalytics,
               tibbletime,timetk,ggthemes,timeDate,Quandl,alphavantager,readxl,broom,
               DEoptim,pso,GenSA,Rglpk,ROI,ROI.plugin.glpk,ROI.plugin.quadprog,doParallel)
```

### Core Functions 
 * **`tq_get()`:** Getting Financial Data from the web. tq_get("company symbol", get = "information")
 * **`tq_transmute()` and `tq_mutate()`:** Manipulating Financial Data
 * **`tq_performance` and `tq_portfolio`** Performance Analysis and Portfolio Analysis


* What about stock performance? Quickly visualize how $10,000 investment in various stocks would perform for the past 15 years. 
  * Comparing with traditional industrial and non-traditional industrial
    * traditional industrial: manufacturing 
    * non-traditional industrial: IT 


### Non-Traditional Industrial: IT 
```{r}
sp500 <- tq_index("sp500")
nyse <- tq_exchange("nyse")
nasdaq <- tq_exchange("NASDAQ")

glimpse(sp500)

glimpse(nyse)

glimpse(nasdaq)
```

Analyze how many sectors and how many companies correspond with sp500. 
```{r}
sector_fields <- sp500 %>% 
  group_by(sector) %>% 
  summarise(
    Quantity = n()
  ) 
sector_fields 
```


Select stock and using inner_joint to keep symbols from the SP500 that are also traded on NYSE and NASDAQ. 
```{r}
stocks.selection <- sp500 %>% 
  inner_join(rbind(nyse,nasdaq) %>% select(symbol, last.sale.price,market.cap, ipo.year), by = c("symbol")) %>% 
  filter(ipo.year<2000 & !is.na(market.cap)) %>% 
  arrange(desc(weight)) %>% 
  slice(1:10)

stocks.selection <- stocks.selection %>% 
  select(symbol, company, weight, sector,shares_held,last.sale.price,market.cap,ipo.year)
stocks.selection
```
As can be seen from the selection table, the main sector is Information Technology company. 


Select Five biggest information technology company from sp500, and also traded on NYSE or NASDAQ. 
```{r}
Information_technology_company <- sp500 %>% 
  inner_join(rbind(nyse,nasdaq) %>% 
               select(symbol, last.sale.price,market.cap, ipo.year),by = c("symbol")) %>% 
  filter(!is.na(market.cap) & ( sector == "Information Technology" | sector == "Communication Services" | sector == "Consumer Discretionary" ) & !is.na(ipo.year)) %>% 
  arrange(desc(weight)) %>% 
  head(5)
Information_technology_company 
```


1. We want to calculate the monthly returns for different stocks and compare the result of those stocks. 
  * Monthly return is the period returns re-scaled to a period of 1 month. This allows investors to compare returns of different assets that they have owned for different lengths of time. 
```{r}
Microsoft <- tq_get("MSFT", get = "stock.prices")
Microsoft_monthly_return <- Microsoft %>% 
  tq_transmute(
    select = adjusted, 
    mutate_fun = periodReturn, 
    period = "monthly",
    col_rename = "monthly_return", 
  )
Microsoft_monthly_return %>% head()
Microsoft_monthly_return %>% ggplot(aes(x = date, y = monthly_return)) + geom_line()
```
As can be see from the result, the monthly shows an unstable fluctuations between -0.1 to +0.2. 

Then we want to analyze the stock price for Microsoft in the past 10-15 years. 
```{r}
tq_get(c("MSFT"), get="stock.prices") %>%
  ggplot(aes(date, close)) +
  geom_line()
```
Although the montly return shows a dramatically fluctuation trend, however, the stock.price incrases dramatically with some minimum fluctuations from the past 15 years. (from less then 150 to more then 1750). However, as can be seen from the line graph. The graph indicates there are some big drops of the stock price between 2015 and 2019. In order to figure out the reason for this result, we want to get more companies information. 

In order to dig deep for this problem, we want to compare Google's stock prices with more big name IT companies like Amazon, Facebook, and Apple. 

```{r}
tq_get(c("MSFT","AAPL", "AMZN","FB","GOOG"), get = "stock.prices") %>% 
  head()
tq_get(c("GOOG", "AMZN","FB","AAPL"), get = "stock.prices") %>% 
  group_by(symbol) %>% 
  tq_transmute(select = adjusted, 
               mutate_fun = periodReturn, 
               period = "monthly", 
               col_rename = "monthly_return") %>% 
  ggplot(aes(date, monthly_return, color = symbol)) + geom_line()
```





```{r}
GAFA_data  <- tq_get(c("MSFT","AAPL", "AMZN","FB","GOOG"), get = "stock.prices") 
GAFA_data %>% head()

tq_get(c("MSFT","AAPL", "AMZN","FB","GOOG"), get="stock.prices") %>%
  ggplot(aes(date, close, color=symbol)) +
  geom_line()
```
As can be see from the graph, the stock prices for Apple, Amazon, Facebook, Google reflect a flctuational period from 2015-2019. The stock prices for Amazon and Google are much higher than Facebook, and Apple. 

### Traditional Industry 
#### Industrials 

Energy
Consumer Staples
Industrials

```{r}
Industrials <- sp500 %>% 
  inner_join(rbind(nasdaq, nyse) %>% 
               select(symbol, last.sale.price, market.cap, ipo.year), by = c("symbol")) %>%
  filter(!is.na(ipo.year) & !is.na(market.cap) & sector == "Industrials" & ipo.year <= 2000) %>% 
  arrange(desc(weight)) %>% 
  slice(1:10) 
Industrials %>% head()
```

```{r}
Industrials <- sp500 %>% 
  inner_join(rbind(nasdaq, nyse) %>% 
               select(symbol, last.sale.price, market.cap, ipo.year), by = c("symbol")) %>%
  filter(!is.na(ipo.year) & !is.na(market.cap) & sector == "Industrials" & ipo.year <= 2000) %>% 
  arrange(ipo.year) %>% 
  slice(1:10) 
Industrials %>% head()
```



Monthly return 
```{r}
tq_get(c("UPS", "ROP", "INFO", "CTAS","FAST"), get = "stock.prices") %>% 
  head()
tq_get(c("UPS", "ROP", "INFO", "CTAS","FAST"), get = "stock.prices") %>% 
  group_by(symbol) %>% 
  tq_transmute(select = adjusted, 
               mutate_fun = periodReturn, 
               period = "monthly", 
               col_rename = "monthly_return") %>% 
  ggplot(aes(date,monthly_return, color = symbol )) + geom_line()
  

```

```{r}
tq_get(c("UPS", "ROP", "INFO", "CTAS","FAST"), get="stock.prices") %>%
  ggplot(aes(date, close, color=symbol)) +
  geom_line()
```
The graph indicates that the stock prices for traditional construction companies. 

**Oil and gas**
Exoon Mobil (XOM)
chevron (CVX)
Conoco Phillips (COP)
EOG Resources (EOG)
```{r}
tq_get(c("XOM","CNX","COP","EOG"), get = "stock.prices") %>% 
  head()

tq_get(c("XOM","CNX","COP","eog"), get = "stock.prices") %>% 
    group_by(symbol) %>% 
  tq_transmute(select = adjusted, 
               mutate_fun = periodReturn, 
               period = "monthly", 
               col_rename = "monthly_return") %>% 
  ggplot(aes(date,monthly_return, color = symbol )) + geom_line()
```

```{r}
tq_get(c("XOM","CNX","COP","EOG"), get = "stock.prices") %>% 
  ggplot(aes(date, close, color = symbol)) + geom_line()
```

**Telecommunications**
AT&T Mobility (T) 
Verizon Wireless (VZ) 
T-Mobile (TMUS) 
Sprint Corporation (S)
```{r}
tq_get(c("T","VZ","TMUS","S"), get = "stock.prices") %>% 
  head()

tq_get(c("T","VZ","TMUS","S"), get = "stock.prices") %>% 
    group_by(symbol) %>% 
  tq_transmute(select = adjusted, 
               mutate_fun = periodReturn, 
               period = "monthly", 
               col_rename = "monthly_return") %>% 
  ggplot(aes(date,monthly_return, color = symbol )) + geom_line()
```

```{r}
tq_get(c("T","VZ","TMUS","S"), get = "stock.prices") %>% 
  ggplot(aes(date,close, color = symbol)) + geom_line()
```
















